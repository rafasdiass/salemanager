<ion-card class="notification-card">
  <ion-card-header>
    <ion-label class="section-title">
      <ion-icon name="create"></ion-icon>
      Criar Nova Notificação
    </ion-label>
  </ion-card-header>

  <ion-card-content>
    <form [formGroup]="notificationForm" (ngSubmit)="submitNotification()">
      <ion-grid class="form-grid">
        <ion-row>
          <!-- Destinatário -->
          <ion-col size="12" size-md="4" class="inner-section destinatario-section">
            <ion-label class="inner-section-title">Destinatário</ion-label>
            <ion-list>
              <ion-radio-group formControlName="destinatario" (ionChange)="setDestinatario($event.detail.value)">
                <ion-item>
                  <ion-radio slot="start" [value]="TipoDestinatario.TODOS_clients"></ion-radio>
                  <ion-label>Todos os clients</ion-label>
                </ion-item>
                <ion-item (click)="selecionarclients()">
                  <ion-radio slot="start" [value]="TipoDestinatario.clients_ESPECIFICOS"></ion-radio>
                  <ion-label>Grupo Específico</ion-label>
                </ion-item>
                <ion-item (click)="onIndividualClicked()">
                  <ion-radio slot="start" [value]="TipoDestinatario.INDIVIDUAL"></ion-radio>
                  <ion-label>Individuais</ion-label>
                </ion-item>
              </ion-radio-group>
            </ion-list>

            <!-- Botão para carregar clients se ainda não estiverem carregados -->
            <ion-button
              *ngIf="notificationForm.value.destinatario === TipoDestinatario.INDIVIDUAL && (!clients || clients.length === 0)"
              (click)="loadclients()" expand="full" color="secondary">
              Carregar clients
            </ion-button>

            <!-- Lista de clients para destinatário INDIVIDUAL -->
            <ng-container
              *ngIf="notificationForm.value.destinatario === TipoDestinatario.INDIVIDUAL && clients?.length">
              <ion-list>
                <ion-item *ngFor="let client of clients" button (click)="selecionarclient(client)">
                  <ion-label>{{ client.first_name }} {{ client.last_name }}</ion-label>
                </ion-item>
              </ion-list>
            </ng-container>
          </ion-col>

          <!-- Tipo de Notificação -->
          <ion-col size="12" size-md="4" class="inner-section tipo-section">
            <ion-label class="inner-section-title">Tipo de Notificação</ion-label>
            <ion-segment formControlName="tipoNotificacao">
              <ion-segment-button *ngFor="let tipo of TipoNotificacao | keyvalue" [value]="tipo.value">
                <ion-label>{{ tipo.value }}</ion-label>
              </ion-segment-button>
            </ion-segment>
          </ion-col>

          <!-- Forma de Envio -->
          <ion-col size="12" size-md="4" class="inner-section envio-section">
            <ion-label class="inner-section-title">Forma de Envio</ion-label>
            <ion-segment formControlName="formaEnvio">
              <ion-segment-button [value]="FormaEnvio.IMEDIATO">
                <ion-label>Envio Imediato</ion-label>
              </ion-segment-button>
              <ion-segment-button [value]="FormaEnvio.AGENDADO">
                <ion-label>Agendar Envio</ion-label>
              </ion-segment-button>
            </ion-segment>

            <ion-button *ngIf="notificationForm.value.formaEnvio === FormaEnvio.AGENDADO" (click)="toggleDatePicker()"
              expand="full" color="secondary">
              <ion-icon name="calendar"></ion-icon>
              Escolher Data
            </ion-button>

            <ion-item *ngIf="showDatePicker()">
              <ion-datetime formControlName="agendadoPara" presentation="date"
                displayFormat="DD/MM/YYYY"></ion-datetime>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- Assunto e Mensagem -->
      <ion-list class="email-fields">
        <ion-item class="email-subject" lines="full">
          <ion-label position="stacked">Assunto</ion-label>
          <ion-input formControlName="titulo" type="text" placeholder="Digite o assunto..."></ion-input>
        </ion-item>

        <ion-item class="email-body" lines="full">
          <ion-label position="stacked">Mensagem</ion-label>
          <ion-textarea formControlName="mensagem" placeholder="Escreva sua mensagem aqui..." rows="8"></ion-textarea>
        </ion-item>

        <!-- Upload de Arquivo -->
        <ion-item class="email-attach" lines="none">
          <ion-label>
            <ion-icon name="attach"></ion-icon>
            Anexar Arquivo
          </ion-label>
          <input type="file" (change)="handleFileUpload($event)" />
        </ion-item>
      </ion-list>

      <!-- Botões -->
      <ion-row class="action-buttons">
        <ion-col>
          <ion-button expand="block" type="submit" [disabled]="isSubmitting()" color="primary">
            <ion-icon slot="start" name="checkmark-circle"></ion-icon>
            Enviar Notificação
          </ion-button>
        </ion-col>
        <ion-col>
          <ion-button expand="block" color="light" (click)="resetForm()">
            <ion-icon slot="start" name="close-circle"></ion-icon>
            Cancelar
          </ion-button>
        </ion-col>
      </ion-row>
    </form>
  </ion-card-content>
</ion-card>